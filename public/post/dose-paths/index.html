<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.3">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Kristian Brock">

  
  
  
    
  
  <meta name="description" content="Enumerate every possible dose selection decision for all dose-finding models implemented in the escalation package.">

  
  <link rel="alternate" hreflang="en-us" href="../../post/dose-paths/">

  


  
  
  
  <meta name="theme-color" content="#EF525B">
  

  
  
  
  <script src="../../js/mathjax-config.js"></script>
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cutive+Mono%7CLora:400,700%7CRoboto:400,700&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="../../css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-157979306-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           document.location = url;
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target);  
  }

  gtag('js', new Date());
  gtag('config', 'UA-157979306-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  

  <link rel="manifest" href="../../index.webmanifest">
  <link rel="icon" type="image/png" href="../../img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="../../img/icon-192.png">

  <link rel="canonical" href="../../post/dose-paths/">

  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@CatchTwentyToo">
  <meta property="twitter:creator" content="@CatchTwentyToo">
  
  <meta property="og:site_name" content="Kristian Brock">
  <meta property="og:url" content="/post/dose-paths/">
  <meta property="og:title" content="Dose-paths in the escalation package | Kristian Brock">
  <meta property="og:description" content="Enumerate every possible dose selection decision for all dose-finding models implemented in the escalation package."><meta property="og:image" content="/post/dose-paths/featured.jpg">
  <meta property="twitter:image" content="/post/dose-paths/featured.jpg"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-04-21T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-04-21T20:41:56&#43;00:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/dose-paths/"
  },
  "headline": "Dose-paths in the escalation package",
  
  "image": [
    "/post/dose-paths/featured.jpg"
  ],
  
  "datePublished": "2020-04-21T00:00:00Z",
  "dateModified": "2020-04-21T20:41:56Z",
  
  "author": {
    "@type": "Person",
    "name": "Kristian Brock"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Kristian Brock",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "Enumerate every possible dose selection decision for all dose-finding models implemented in the escalation package."
}
</script>

  

  


  


  





  <title>Dose-paths in the escalation package | Kristian Brock</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  

<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="../../">Kristian Brock</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="../../">Kristian Brock</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#featured"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="../../courses/"><span>Teaching</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#contact"><span>Contact Me</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>Dose-paths in the escalation package</h1>

  
  <p class="page-subtitle">Enumerate every possible dose selection decision for all dose-finding models implemented in the escalation package.</p>
  

  


<div class="article-metadata">

  
  
  
  
  <div>
    



  
  <span><a href="../../authors/admin/">Kristian Brock</a></span>

  </div>
  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Apr 21, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    34 min read
  </span>
  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="../../categories/code/">Code</a></span>
  

</div>

  













<div class="btn-links mb-3">
  
  








  









  
  <a class="btn btn-outline-primary my-1 mr-1" href="../../project/escalation/">
    Project
  </a>
  











</div>


</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 482px;">
  <div style="position: relative">
    <img src="../../post/dose-paths/featured_hu7dee932997e3c7a432aa3a84b796b323_464082_720x0_resize_q90_lanczos.jpg" alt="" class="featured-image">
    <span class="article-header-caption">Photo by <a href="https://unsplash.com/photos/u0vgcIOQG08">Jens Lelie on Unsplash</a></span>
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      
<script src="../../rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="../../rmarkdown-libs/viz/viz.js"></script>
<link href="../../rmarkdown-libs/DiagrammeR-styles/styles.css" rel="stylesheet" />
<script src="../../rmarkdown-libs/grViz-binding/grViz.js"></script>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Dose-finding clinical trials investigate experimental agents, seeking doses that are tolerable and active.
They commonly use some dose-selection model to analyse binary outcomes at increasing doses in cohorts of patients.
It is possible to analyse the behaviour of a dose-finding design by exhaustively calculating every possible set of outcomes and invoking the dose selection model on each.
We will refer to these hypothetical sequences of doses in response to outcomes as <em>dose-paths</em>.</p>
<p>An example will make this clear.
The 3+3 design is widely understood.
One of its benefits is its simplicity.
Let us investigate the first two cohorts of three patients in the 3+3 variant that permits de-escalation.
We calculate dose-paths in <code>escalation</code> using the <code>get_dose_paths</code> function:</p>
<pre class="r"><code>library(escalation)</code></pre>
<pre><code>## Loading required package: magrittr</code></pre>
<pre class="r"><code>paths &lt;- get_three_plus_three(num_doses = 5, allow_deescalate = TRUE) %&gt;% 
  get_dose_paths(cohort_sizes = c(3, 3))</code></pre>
<p><code>get_dose_paths</code> takes a dose-selection methodology and enumerates every possible path according to the cohort sizes that you specify.
The returned <code>paths</code> object contains lot of information but the most pertinent perhaps is the sequence of dose-recommendations in response to hypothetical outcomes:</p>
<pre class="r"><code>paths</code></pre>
<pre><code>## Give dose 1: 
##   NNN -&gt; 2 
##     NNN -&gt; 3 
##     NNT -&gt; 2 
##     NTT -&gt; 1 
##     TTT -&gt; 1 
##   NNT -&gt; 1 
##     NNN -&gt; 2 
##     NNT -&gt; NA 
##     NTT -&gt; NA 
##     TTT -&gt; NA 
##   NTT -&gt; NA 
##   TTT -&gt; NA</code></pre>
<p>We see above that the trial starts at dose 1.
If three non-toxicities (N) are seen, the algorithm advocates escalation to dose 2.
In constrast if two or more toxicities (T) are seen in the first cohort, no dose is selected (the dose is <code>NA</code>) and the trial stops.
Subsequent cohorts are represented by greater levels of indentation.</p>
<p>This information is better represented by a graph.
If you are using RStudio, the graph will appear in the <em>Viewer</em> pane.
(In this vignette, we suppress non-RStudio demonstration of the graphs to avoid problems on CRAN computers.)</p>
<pre class="r"><code>graph_paths(paths)</code></pre>
<div id="htmlwidget-1" style="width:672px;height:672px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"1\", fontcolor = \"#7AD151FF\", fillcolor = \"#414487FF\"] \n  \"2\" [label = \"2\", fontcolor = \"#FDE725FF\", fillcolor = \"#2A788EFF\"] \n  \"3\" [label = \"3\", fontcolor = \"#440154FF\", fillcolor = \"#22A884FF\"] \n  \"4\" [label = \"1\", fontcolor = \"#7AD151FF\", fillcolor = \"#414487FF\"] \n  \"5\" [label = \"2\", fontcolor = \"#FDE725FF\", fillcolor = \"#2A788EFF\"] \n  \"6\" [label = \"Stop\", fontcolor = \"#22A884FF\", fillcolor = \"#440154FF\"] \n  \"7\" [label = \"Stop\", fontcolor = \"#22A884FF\", fillcolor = \"#440154FF\"] \n  \"8\" [label = \"2\", fontcolor = \"#FDE725FF\", fillcolor = \"#2A788EFF\"] \n  \"9\" [label = \"Stop\", fontcolor = \"#22A884FF\", fillcolor = \"#440154FF\"] \n  \"10\" [label = \"1\", fontcolor = \"#7AD151FF\", fillcolor = \"#414487FF\"] \n  \"11\" [label = \"Stop\", fontcolor = \"#22A884FF\", fillcolor = \"#440154FF\"] \n  \"12\" [label = \"1\", fontcolor = \"#7AD151FF\", fillcolor = \"#414487FF\"] \n  \"13\" [label = \"Stop\", fontcolor = \"#22A884FF\", fillcolor = \"#440154FF\"] \n\"1\"->\"2\" [label = \"NNN\"] \n\"2\"->\"3\" [label = \"NNN\"] \n\"1\"->\"4\" [label = \"NNT\"] \n\"4\"->\"5\" [label = \"NNN\"] \n\"1\"->\"6\" [label = \"NTT\"] \n\"1\"->\"7\" [label = \"TTT\"] \n\"2\"->\"8\" [label = \"NNT\"] \n\"4\"->\"9\" [label = \"NNT\"] \n\"2\"->\"10\" [label = \"NTT\"] \n\"4\"->\"11\" [label = \"NTT\"] \n\"2\"->\"12\" [label = \"TTT\"] \n\"4\"->\"13\" [label = \"TTT\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>The blue node towards the centre bearing the number <code>1</code> represents the start of the trial.
The edges of the graph (the lines connecting the nodes) represent the outcomes in cohorts of patients.
As before, we see that if three <code>N</code> events are seen, the trial escalates to dose 2.
Three patients are assumed to be treated at that dose and from there, further escalation to dose 3 will be advised if no toxicity is seen.
In contrast, dose 2 will be retained for a further cohort of three if a single toxicity is seen, and de-escalation to dose 1 will occur if two or more toxicities are seen.
This is exactly the behaviour we expect from the 3+3 design.</p>
<p>Dose-paths were introduced in the phase I setting that we consider here by <span class="citation">Yap et al. (2017)</span>.
Their phase I/II analogue was introduced by <span class="citation">Brock et al. (2017)</span> for dose-finding trials that consider efficacy and toxicity outcomes.</p>
</div>
<div id="other-models" class="section level1">
<h1>Other Models</h1>
<div id="crm" class="section level2">
<h2>CRM</h2>
<p>The above example uses the 3+3 design but other methods are available.
In fact, early phase statisticians would much prefer that you use a model-based method <span class="citation">(Wheeler et al. 2019)</span>.
The <code>escalation</code> package is intentionally written so that all dose selectors look the same, regardless the implementation-level details.
In computing terminology, dose selectors in <code>escalation</code> support a common interface.
This makes it trivial to calculate dose-paths for all dose-selectors - we just use the <code>get_dose_paths</code> function again.</p>
<p>Let us investigate a continual reassessment method (CRM) design now, as described by <span class="citation">O’Quigley, Pepe, and Fisher (1990)</span> and implemented by the dfcrm package <span class="citation">(Cheung 2013)</span>.
We must specify a dose-toxicity skeleton, and a target toxicity level:</p>
<pre class="r"><code>skeleton &lt;- c(0.05, 0.1, 0.25, 0.4, 0.6)
target &lt;- 0.25</code></pre>
<p>We can then specify a CRM model and calculate dose-paths as before:</p>
<pre class="r"><code>paths &lt;- get_dfcrm(skeleton = skeleton, target = target) %&gt;%
  get_dose_paths(cohort_sizes = c(3, 3))</code></pre>
<p>When we graph the paths this time (and adopt a different colour palette for fun):</p>
<pre class="r"><code>graph_paths(paths, viridis_palette = &#39;magma&#39;)</code></pre>
<div id="htmlwidget-2" style="width:672px;height:672px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"2\" [label = \"4\", fontcolor = \"#3B0F70FF\", fillcolor = \"#FE9F6DFF\"] \n  \"3\" [label = \"5\", fontcolor = \"#8C2981FF\", fillcolor = \"#FCFDBFFF\"] \n  \"4\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"5\" [label = \"2\", fontcolor = \"#FCFDBFFF\", fillcolor = \"#8C2981FF\"] \n  \"6\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"7\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"8\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"9\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"10\" [label = \"3\", fontcolor = \"#000004FF\", fillcolor = \"#DE4968FF\"] \n  \"11\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"12\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"13\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"14\" [label = \"2\", fontcolor = \"#FCFDBFFF\", fillcolor = \"#8C2981FF\"] \n  \"15\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"16\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"17\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"18\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"19\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"20\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n  \"21\" [label = \"1\", fontcolor = \"#FE9F6DFF\", fillcolor = \"#3B0F70FF\"] \n\"1\"->\"2\" [label = \"NNN\"] \n\"2\"->\"3\" [label = \"NNN\"] \n\"1\"->\"4\" [label = \"NNT\"] \n\"4\"->\"5\" [label = \"NNN\"] \n\"1\"->\"6\" [label = \"NTT\"] \n\"6\"->\"7\" [label = \"NNN\"] \n\"1\"->\"8\" [label = \"TTT\"] \n\"8\"->\"9\" [label = \"NNN\"] \n\"2\"->\"10\" [label = \"NNT\"] \n\"4\"->\"11\" [label = \"NNT\"] \n\"6\"->\"12\" [label = \"NNT\"] \n\"8\"->\"13\" [label = \"NNT\"] \n\"2\"->\"14\" [label = \"NTT\"] \n\"4\"->\"15\" [label = \"NTT\"] \n\"6\"->\"16\" [label = \"NTT\"] \n\"8\"->\"17\" [label = \"NTT\"] \n\"2\"->\"18\" [label = \"TTT\"] \n\"4\"->\"19\" [label = \"TTT\"] \n\"6\"->\"20\" [label = \"TTT\"] \n\"8\"->\"21\" [label = \"TTT\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>we see that the <code>Stop</code> node is absent - all paths recommend a dose, even those seeing substantial toxicity.
Stopping behaviours must be specified for the CRM method.
Fortunately, <code>escalation</code> makes this simple.</p>
<p>An intuitive method for stopping in the Bayesian setting is to test the posterior distribution for the probability of toxicity.
In our example, we will stop if there is at least a 90% probability that the toxicity rate at the lowest dose is 35% or greater:</p>
<pre class="r"><code>paths &lt;- get_dfcrm(skeleton = skeleton, target = target) %&gt;%
  stop_when_too_toxic(dose = 1, tox_threshold = 0.35, confidence = 0.9) %&gt;% 
  get_dose_paths(cohort_sizes = c(3, 3))</code></pre>
<p>When we visualise the paths from the updated model:</p>
<pre class="r"><code>graph_paths(paths, viridis_palette = &#39;inferno&#39;)</code></pre>
<div id="htmlwidget-3" style="width:672px;height:672px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"1\", fontcolor = \"#FCA50AFF\", fillcolor = \"#420A68FF\"] \n  \"2\" [label = \"4\", fontcolor = \"#420A68FF\", fillcolor = \"#FCA50AFF\"] \n  \"3\" [label = \"5\", fontcolor = \"#932667FF\", fillcolor = \"#FCFFA4FF\"] \n  \"4\" [label = \"1\", fontcolor = \"#FCA50AFF\", fillcolor = \"#420A68FF\"] \n  \"5\" [label = \"2\", fontcolor = \"#FCFFA4FF\", fillcolor = \"#932667FF\"] \n  \"6\" [label = \"1\", fontcolor = \"#FCA50AFF\", fillcolor = \"#420A68FF\"] \n  \"7\" [label = \"1\", fontcolor = \"#FCA50AFF\", fillcolor = \"#420A68FF\"] \n  \"8\" [label = \"Stop\", fontcolor = \"#DD513AFF\", fillcolor = \"#000004FF\"] \n  \"9\" [label = \"3\", fontcolor = \"#000004FF\", fillcolor = \"#DD513AFF\"] \n  \"10\" [label = \"1\", fontcolor = \"#FCA50AFF\", fillcolor = \"#420A68FF\"] \n  \"11\" [label = \"1\", fontcolor = \"#FCA50AFF\", fillcolor = \"#420A68FF\"] \n  \"12\" [label = \"2\", fontcolor = \"#FCFFA4FF\", fillcolor = \"#932667FF\"] \n  \"13\" [label = \"1\", fontcolor = \"#FCA50AFF\", fillcolor = \"#420A68FF\"] \n  \"14\" [label = \"1\", fontcolor = \"#FCA50AFF\", fillcolor = \"#420A68FF\"] \n  \"15\" [label = \"1\", fontcolor = \"#FCA50AFF\", fillcolor = \"#420A68FF\"] \n  \"16\" [label = \"1\", fontcolor = \"#FCA50AFF\", fillcolor = \"#420A68FF\"] \n  \"17\" [label = \"Stop\", fontcolor = \"#DD513AFF\", fillcolor = \"#000004FF\"] \n\"1\"->\"2\" [label = \"NNN\"] \n\"2\"->\"3\" [label = \"NNN\"] \n\"1\"->\"4\" [label = \"NNT\"] \n\"4\"->\"5\" [label = \"NNN\"] \n\"1\"->\"6\" [label = \"NTT\"] \n\"6\"->\"7\" [label = \"NNN\"] \n\"1\"->\"8\" [label = \"TTT\"] \n\"2\"->\"9\" [label = \"NNT\"] \n\"4\"->\"10\" [label = \"NNT\"] \n\"6\"->\"11\" [label = \"NNT\"] \n\"2\"->\"12\" [label = \"NTT\"] \n\"4\"->\"13\" [label = \"NTT\"] \n\"6\"->\"14\" [label = \"NTT\"] \n\"2\"->\"15\" [label = \"TTT\"] \n\"4\"->\"16\" [label = \"TTT\"] \n\"6\"->\"17\" [label = \"TTT\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>we see that some paths once again recommend stopping.
The paths that recommend a dose are otherwise unchanged.</p>
</div>
<div id="boin" class="section level2">
<h2>BOIN</h2>
<p>Another dose-escalation model implemented in <code>escalation</code> is the Bayesian optimal interval (BOIN) method by <span class="citation">Liu and Yuan (2015)</span>, implemented in the <code>BOIN</code> package <span class="citation">(Yuan and Liu 2018)</span>.</p>
<p>To spice things up, we will visualise how this model behaves over four cohorts of two patients:</p>
<pre class="r"><code>paths &lt;- get_boin(num_doses = 4, target = target) %&gt;% 
  get_dose_paths(cohort_sizes = rep(2, 4))</code></pre>
<pre><code>## You have requested 121 model evaluations. Be patient.</code></pre>
<pre class="r"><code>graph_paths(paths, RColorBrewer_palette = &#39;YlOrRd&#39;)</code></pre>
<div id="htmlwidget-4" style="width:672px;height:672px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"2\" [label = \"2\", fontcolor = \"#BD0026\", fillcolor = \"#FD8D3C\"] \n  \"3\" [label = \"3\", fontcolor = \"#FFFFB2\", fillcolor = \"#F03B20\"] \n  \"4\" [label = \"4\", fontcolor = \"#FECC5C\", fillcolor = \"#BD0026\"] \n  \"5\" [label = \"4\", fontcolor = \"#FECC5C\", fillcolor = \"#BD0026\"] \n  \"6\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"7\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"8\" [label = \"2\", fontcolor = \"#BD0026\", fillcolor = \"#FD8D3C\"] \n  \"9\" [label = \"3\", fontcolor = \"#FFFFB2\", fillcolor = \"#F03B20\"] \n  \"10\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"11\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"12\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"13\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"14\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"15\" [label = \"2\", fontcolor = \"#BD0026\", fillcolor = \"#FD8D3C\"] \n  \"16\" [label = \"2\", fontcolor = \"#BD0026\", fillcolor = \"#FD8D3C\"] \n  \"17\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"18\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"19\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"20\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"21\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"22\" [label = \"2\", fontcolor = \"#BD0026\", fillcolor = \"#FD8D3C\"] \n  \"23\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"24\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"25\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"26\" [label = \"2\", fontcolor = \"#BD0026\", fillcolor = \"#FD8D3C\"] \n  \"27\" [label = \"3\", fontcolor = \"#FFFFB2\", fillcolor = \"#F03B20\"] \n  \"28\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"29\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"30\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"31\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"32\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"33\" [label = \"2\", fontcolor = \"#BD0026\", fillcolor = \"#FD8D3C\"] \n  \"34\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"35\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"36\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"37\" [label = \"2\", fontcolor = \"#BD0026\", fillcolor = \"#FD8D3C\"] \n  \"38\" [label = \"2\", fontcolor = \"#BD0026\", fillcolor = \"#FD8D3C\"] \n  \"39\" [label = \"3\", fontcolor = \"#FFFFB2\", fillcolor = \"#F03B20\"] \n  \"40\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"41\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"42\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"43\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"44\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"45\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"46\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"47\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"48\" [label = \"3\", fontcolor = \"#FFFFB2\", fillcolor = \"#F03B20\"] \n  \"49\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"50\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"51\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"52\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"53\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"54\" [label = \"2\", fontcolor = \"#BD0026\", fillcolor = \"#FD8D3C\"] \n  \"55\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"56\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"57\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"58\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"59\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"60\" [label = \"2\", fontcolor = \"#BD0026\", fillcolor = \"#FD8D3C\"] \n  \"61\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"62\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"63\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"64\" [label = \"3\", fontcolor = \"#FFFFB2\", fillcolor = \"#F03B20\"] \n  \"65\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"66\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"67\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"68\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"69\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"70\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"71\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"72\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"73\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"74\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"75\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"76\" [label = \"1\", fontcolor = \"#F03B20\", fillcolor = \"#FECC5C\"] \n  \"77\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"78\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n  \"79\" [label = \"Stop\", fontcolor = \"#FD8D3C\", fillcolor = \"#FFFFB2\"] \n\"1\"->\"2\" [label = \"NN\"] \n\"2\"->\"3\" [label = \"NN\"] \n\"3\"->\"4\" [label = \"NN\"] \n\"4\"->\"5\" [label = \"NN\"] \n\"1\"->\"6\" [label = \"NT\"] \n\"6\"->\"7\" [label = \"NN\"] \n\"7\"->\"8\" [label = \"NN\"] \n\"8\"->\"9\" [label = \"NN\"] \n\"1\"->\"10\" [label = \"TT\"] \n\"10\"->\"11\" [label = \"NN\"] \n\"11\"->\"12\" [label = \"NN\"] \n\"12\"->\"13\" [label = \"NN\"] \n\"2\"->\"14\" [label = \"NT\"] \n\"14\"->\"15\" [label = \"NN\"] \n\"15\"->\"16\" [label = \"NN\"] \n\"6\"->\"17\" [label = \"NT\"] \n\"17\"->\"18\" [label = \"NN\"] \n\"18\"->\"19\" [label = \"NN\"] \n\"10\"->\"20\" [label = \"NT\"] \n\"2\"->\"21\" [label = \"TT\"] \n\"21\"->\"22\" [label = \"NN\"] \n\"22\"->\"23\" [label = \"NN\"] \n\"6\"->\"24\" [label = \"TT\"] \n\"10\"->\"25\" [label = \"TT\"] \n\"3\"->\"26\" [label = \"NT\"] \n\"26\"->\"27\" [label = \"NN\"] \n\"7\"->\"28\" [label = \"NT\"] \n\"28\"->\"29\" [label = \"NN\"] \n\"11\"->\"30\" [label = \"NT\"] \n\"30\"->\"31\" [label = \"NN\"] \n\"14\"->\"32\" [label = \"NT\"] \n\"32\"->\"33\" [label = \"NN\"] \n\"17\"->\"34\" [label = \"NT\"] \n\"34\"->\"35\" [label = \"NN\"] \n\"21\"->\"36\" [label = \"NT\"] \n\"36\"->\"37\" [label = \"NN\"] \n\"3\"->\"38\" [label = \"TT\"] \n\"38\"->\"39\" [label = \"NN\"] \n\"7\"->\"40\" [label = \"TT\"] \n\"40\"->\"41\" [label = \"NN\"] \n\"11\"->\"42\" [label = \"TT\"] \n\"14\"->\"43\" [label = \"TT\"] \n\"43\"->\"44\" [label = \"NN\"] \n\"17\"->\"45\" [label = \"TT\"] \n\"21\"->\"46\" [label = \"TT\"] \n\"46\"->\"47\" [label = \"NN\"] \n\"4\"->\"48\" [label = \"NT\"] \n\"8\"->\"49\" [label = \"NT\"] \n\"12\"->\"50\" [label = \"NT\"] \n\"15\"->\"51\" [label = \"NT\"] \n\"18\"->\"52\" [label = \"NT\"] \n\"22\"->\"53\" [label = \"NT\"] \n\"26\"->\"54\" [label = \"NT\"] \n\"28\"->\"55\" [label = \"NT\"] \n\"30\"->\"56\" [label = \"NT\"] \n\"32\"->\"57\" [label = \"NT\"] \n\"34\"->\"58\" [label = \"NT\"] \n\"36\"->\"59\" [label = \"NT\"] \n\"38\"->\"60\" [label = \"NT\"] \n\"40\"->\"61\" [label = \"NT\"] \n\"43\"->\"62\" [label = \"NT\"] \n\"46\"->\"63\" [label = \"NT\"] \n\"4\"->\"64\" [label = \"TT\"] \n\"8\"->\"65\" [label = \"TT\"] \n\"12\"->\"66\" [label = \"TT\"] \n\"15\"->\"67\" [label = \"TT\"] \n\"18\"->\"68\" [label = \"TT\"] \n\"22\"->\"69\" [label = \"TT\"] \n\"26\"->\"70\" [label = \"TT\"] \n\"28\"->\"71\" [label = \"TT\"] \n\"30\"->\"72\" [label = \"TT\"] \n\"32\"->\"73\" [label = \"TT\"] \n\"34\"->\"74\" [label = \"TT\"] \n\"36\"->\"75\" [label = \"TT\"] \n\"38\"->\"76\" [label = \"TT\"] \n\"40\"->\"77\" [label = \"TT\"] \n\"43\"->\"78\" [label = \"TT\"] \n\"46\"->\"79\" [label = \"TT\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>The first thing to note about the graph above is that it is much more complex than the previous graphs.
The number of nodes in dose-paths increases faster than linearly as more cohorts are considered.
Consideration of this must be given when visualising dose-paths.</p>
<p>Secondly, the visual method makes it simple to discern messages about future model behaviour.
For instance, we can easily see that dose 4, the darkest red node, is only reached in the first four cohorts if the first cohort sees no toxicity.</p>
<p>In contrast to CRM, BOIN does have a stopping rule for excess toxicity built in.
We see that <code>TT</code> in the first cohort is not enough to advocate stopping but that any further toxicity in the second cohort will be sufficient to warrant stopping.</p>
</div>
</div>
<div id="further-options" class="section level1">
<h1>Further options</h1>
<div id="non-uniform-cohorts" class="section level2">
<h2>Non-uniform cohorts</h2>
<p>There is no reason that the cohort sizes should be uniform.
Specify whatever <code>cohort_sizes</code> you like:</p>
<pre class="r"><code>paths &lt;- get_boin(num_doses = 4, target = target) %&gt;% 
  get_dose_paths(cohort_sizes = c(3, 1, 2))

graph_paths(paths, RColorBrewer_palette = &#39;Blues&#39;)</code></pre>
<div id="htmlwidget-5" style="width:672px;height:672px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-5">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"2\" [label = \"2\", fontcolor = \"#08519C\", fillcolor = \"#6BAED6\"] \n  \"3\" [label = \"3\", fontcolor = \"#EFF3FF\", fillcolor = \"#3182BD\"] \n  \"4\" [label = \"4\", fontcolor = \"#BDD7E7\", fillcolor = \"#08519C\"] \n  \"5\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"6\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"7\" [label = \"2\", fontcolor = \"#08519C\", fillcolor = \"#6BAED6\"] \n  \"8\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"9\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"10\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"11\" [label = \"Stop\", fontcolor = \"#6BAED6\", fillcolor = \"#EFF3FF\"] \n  \"12\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"13\" [label = \"2\", fontcolor = \"#08519C\", fillcolor = \"#6BAED6\"] \n  \"14\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"15\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"16\" [label = \"Stop\", fontcolor = \"#6BAED6\", fillcolor = \"#EFF3FF\"] \n  \"17\" [label = \"2\", fontcolor = \"#08519C\", fillcolor = \"#6BAED6\"] \n  \"18\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"19\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"20\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"21\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"22\" [label = \"2\", fontcolor = \"#08519C\", fillcolor = \"#6BAED6\"] \n  \"23\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"24\" [label = \"Stop\", fontcolor = \"#6BAED6\", fillcolor = \"#EFF3FF\"] \n  \"25\" [label = \"1\", fontcolor = \"#3182BD\", fillcolor = \"#BDD7E7\"] \n  \"26\" [label = \"Stop\", fontcolor = \"#6BAED6\", fillcolor = \"#EFF3FF\"] \n\"1\"->\"2\" [label = \"NNN\"] \n\"2\"->\"3\" [label = \"N\"] \n\"3\"->\"4\" [label = \"NN\"] \n\"1\"->\"5\" [label = \"NNT\"] \n\"5\"->\"6\" [label = \"N\"] \n\"6\"->\"7\" [label = \"NN\"] \n\"1\"->\"8\" [label = \"NTT\"] \n\"8\"->\"9\" [label = \"N\"] \n\"9\"->\"10\" [label = \"NN\"] \n\"1\"->\"11\" [label = \"TTT\"] \n\"2\"->\"12\" [label = \"T\"] \n\"12\"->\"13\" [label = \"NN\"] \n\"5\"->\"14\" [label = \"T\"] \n\"14\"->\"15\" [label = \"NN\"] \n\"8\"->\"16\" [label = \"T\"] \n\"3\"->\"17\" [label = \"NT\"] \n\"6\"->\"18\" [label = \"NT\"] \n\"9\"->\"19\" [label = \"NT\"] \n\"12\"->\"20\" [label = \"NT\"] \n\"14\"->\"21\" [label = \"NT\"] \n\"3\"->\"22\" [label = \"TT\"] \n\"6\"->\"23\" [label = \"TT\"] \n\"9\"->\"24\" [label = \"TT\"] \n\"12\"->\"25\" [label = \"TT\"] \n\"14\"->\"26\" [label = \"TT\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>You can even evaluate the dose advice after each patient using cohort sizes of 1:</p>
<pre class="r"><code>paths &lt;- get_boin(num_doses = 4, target = target) %&gt;% 
  get_dose_paths(cohort_sizes = rep(1, 4))

graph_paths(paths, RColorBrewer_palette = &#39;RdPu&#39;)</code></pre>
<div id="htmlwidget-6" style="width:672px;height:672px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-6">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"2\" [label = \"2\", fontcolor = \"#7A0177\", fillcolor = \"#F768A1\"] \n  \"3\" [label = \"3\", fontcolor = \"#FEEBE2\", fillcolor = \"#C51B8A\"] \n  \"4\" [label = \"4\", fontcolor = \"#FBB4B9\", fillcolor = \"#7A0177\"] \n  \"5\" [label = \"4\", fontcolor = \"#FBB4B9\", fillcolor = \"#7A0177\"] \n  \"6\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"7\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"8\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"9\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"10\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"11\" [label = \"2\", fontcolor = \"#7A0177\", fillcolor = \"#F768A1\"] \n  \"12\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"13\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"14\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"15\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"16\" [label = \"2\", fontcolor = \"#7A0177\", fillcolor = \"#F768A1\"] \n  \"17\" [label = \"3\", fontcolor = \"#FEEBE2\", fillcolor = \"#C51B8A\"] \n  \"18\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"19\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"20\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"21\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"22\" [label = \"Stop\", fontcolor = \"#F768A1\", fillcolor = \"#FEEBE2\"] \n  \"23\" [label = \"3\", fontcolor = \"#FEEBE2\", fillcolor = \"#C51B8A\"] \n  \"24\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"25\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"26\" [label = \"Stop\", fontcolor = \"#F768A1\", fillcolor = \"#FEEBE2\"] \n  \"27\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n  \"28\" [label = \"Stop\", fontcolor = \"#F768A1\", fillcolor = \"#FEEBE2\"] \n  \"29\" [label = \"1\", fontcolor = \"#C51B8A\", fillcolor = \"#FBB4B9\"] \n\"1\"->\"2\" [label = \"N\"] \n\"2\"->\"3\" [label = \"N\"] \n\"3\"->\"4\" [label = \"N\"] \n\"4\"->\"5\" [label = \"N\"] \n\"1\"->\"6\" [label = \"T\"] \n\"6\"->\"7\" [label = \"N\"] \n\"7\"->\"8\" [label = \"N\"] \n\"8\"->\"9\" [label = \"N\"] \n\"2\"->\"10\" [label = \"T\"] \n\"10\"->\"11\" [label = \"N\"] \n\"11\"->\"12\" [label = \"N\"] \n\"6\"->\"13\" [label = \"T\"] \n\"13\"->\"14\" [label = \"N\"] \n\"14\"->\"15\" [label = \"N\"] \n\"3\"->\"16\" [label = \"T\"] \n\"16\"->\"17\" [label = \"N\"] \n\"7\"->\"18\" [label = \"T\"] \n\"18\"->\"19\" [label = \"N\"] \n\"10\"->\"20\" [label = \"T\"] \n\"20\"->\"21\" [label = \"N\"] \n\"13\"->\"22\" [label = \"T\"] \n\"4\"->\"23\" [label = \"T\"] \n\"8\"->\"24\" [label = \"T\"] \n\"11\"->\"25\" [label = \"T\"] \n\"14\"->\"26\" [label = \"T\"] \n\"16\"->\"27\" [label = \"T\"] \n\"18\"->\"28\" [label = \"T\"] \n\"20\"->\"29\" [label = \"T\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="partially-completed-trials" class="section level2">
<h2>Partially completed trials</h2>
<p>It is possible to calculate dose-paths from trials that are partially completed.
For instance, let us continue with our BOIN model and assume that we have seen outcomes <code>1NNN 2TNT</code> so far in our trial.
Thus, we are reasonably sure that dose 1 is safe but wary that dose 2 might be too toxic.
However, these beliefs are tempered by the tiny sample size.
From this starting point, how might the next two cohorts of three proceed?
We just specify the previous outcomes using the <code>previous_outcomes</code> parameter:</p>
<pre class="r"><code>paths &lt;- get_boin(num_doses = 4, target = target) %&gt;% 
  get_dose_paths(cohort_sizes = rep(3, 2), previous_outcomes = &#39;1NNN 2TNT&#39;)

graph_paths(paths, viridis_palette = &#39;viridis&#39;)</code></pre>
<div id="htmlwidget-7" style="width:672px;height:672px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-7">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"2\" [label = \"2\", fontcolor = \"#FDE725FF\", fillcolor = \"#21908CFF\"] \n  \"3\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"4\" [label = \"2\", fontcolor = \"#FDE725FF\", fillcolor = \"#21908CFF\"] \n  \"5\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"6\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"7\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"8\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"9\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"10\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"11\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"12\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"13\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"14\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"15\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"16\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"17\" [label = \"Stop\", fontcolor = \"#21908CFF\", fillcolor = \"#440154FF\"] \n  \"18\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"19\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"20\" [label = \"Stop\", fontcolor = \"#21908CFF\", fillcolor = \"#440154FF\"] \n  \"21\" [label = \"Stop\", fontcolor = \"#21908CFF\", fillcolor = \"#440154FF\"] \n\"1\"->\"2\" [label = \"NNN\"] \n\"2\"->\"3\" [label = \"NNN\"] \n\"1\"->\"4\" [label = \"NNT\"] \n\"4\"->\"5\" [label = \"NNN\"] \n\"1\"->\"6\" [label = \"NTT\"] \n\"6\"->\"7\" [label = \"NNN\"] \n\"1\"->\"8\" [label = \"TTT\"] \n\"8\"->\"9\" [label = \"NNN\"] \n\"2\"->\"10\" [label = \"NNT\"] \n\"4\"->\"11\" [label = \"NNT\"] \n\"6\"->\"12\" [label = \"NNT\"] \n\"8\"->\"13\" [label = \"NNT\"] \n\"2\"->\"14\" [label = \"NTT\"] \n\"4\"->\"15\" [label = \"NTT\"] \n\"6\"->\"16\" [label = \"NTT\"] \n\"8\"->\"17\" [label = \"NTT\"] \n\"2\"->\"18\" [label = \"TTT\"] \n\"4\"->\"19\" [label = \"TTT\"] \n\"6\"->\"20\" [label = \"TTT\"] \n\"8\"->\"21\" [label = \"TTT\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Notice how this is different to the advice we get at the start of the trial (i.e. when omitting the <code>previous_outcomes</code>):</p>
<pre class="r"><code>paths &lt;- get_boin(num_doses = 4, target = target) %&gt;% 
  get_dose_paths(cohort_sizes = rep(3, 2))

graph_paths(paths, viridis_palette = &#39;viridis&#39;)</code></pre>
<div id="htmlwidget-8" style="width:672px;height:672px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-8">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"2\" [label = \"2\", fontcolor = \"#FDE725FF\", fillcolor = \"#21908CFF\"] \n  \"3\" [label = \"3\", fontcolor = \"#440154FF\", fillcolor = \"#5DC863FF\"] \n  \"4\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"5\" [label = \"2\", fontcolor = \"#FDE725FF\", fillcolor = \"#21908CFF\"] \n  \"6\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"7\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"8\" [label = \"Stop\", fontcolor = \"#21908CFF\", fillcolor = \"#440154FF\"] \n  \"9\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"10\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"11\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"12\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"13\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"14\" [label = \"Stop\", fontcolor = \"#21908CFF\", fillcolor = \"#440154FF\"] \n  \"15\" [label = \"1\", fontcolor = \"#5DC863FF\", fillcolor = \"#3B528BFF\"] \n  \"16\" [label = \"Stop\", fontcolor = \"#21908CFF\", fillcolor = \"#440154FF\"] \n  \"17\" [label = \"Stop\", fontcolor = \"#21908CFF\", fillcolor = \"#440154FF\"] \n\"1\"->\"2\" [label = \"NNN\"] \n\"2\"->\"3\" [label = \"NNN\"] \n\"1\"->\"4\" [label = \"NNT\"] \n\"4\"->\"5\" [label = \"NNN\"] \n\"1\"->\"6\" [label = \"NTT\"] \n\"6\"->\"7\" [label = \"NNN\"] \n\"1\"->\"8\" [label = \"TTT\"] \n\"2\"->\"9\" [label = \"NNT\"] \n\"4\"->\"10\" [label = \"NNT\"] \n\"6\"->\"11\" [label = \"NNT\"] \n\"2\"->\"12\" [label = \"NTT\"] \n\"4\"->\"13\" [label = \"NTT\"] \n\"6\"->\"14\" [label = \"NTT\"] \n\"2\"->\"15\" [label = \"TTT\"] \n\"4\"->\"16\" [label = \"TTT\"] \n\"6\"->\"17\" [label = \"TTT\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>This is a feature of model-based methods like CRM and BOIN - they use all information at all doses when making dose decisions.
They are not memoryless like the 3+3.</p>
</div>
<div id="next-dose" class="section level2">
<h2>Next dose</h2>
<p>The dose at which dose-paths commence is inferred from the model.
It can be specified manually, however:</p>
<pre class="r"><code>paths &lt;- get_three_plus_three(num_doses = 5, allow_deescalate = TRUE) %&gt;% 
  get_dose_paths(cohort_sizes = c(3, 3), next_dose = 3)

graph_paths(paths, viridis_palette = &#39;plasma&#39;)</code></pre>
<div id="htmlwidget-9" style="width:672px;height:672px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-9">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"3\", fontcolor = \"#0D0887FF\", fillcolor = \"#E16462FF\"] \n  \"2\" [label = \"4\", fontcolor = \"#6A00A8FF\", fillcolor = \"#FCA636FF\"] \n  \"3\" [label = \"5\", fontcolor = \"#B12A90FF\", fillcolor = \"#F0F921FF\"] \n  \"4\" [label = \"3\", fontcolor = \"#0D0887FF\", fillcolor = \"#E16462FF\"] \n  \"5\" [label = \"4\", fontcolor = \"#6A00A8FF\", fillcolor = \"#FCA636FF\"] \n  \"6\" [label = \"2\", fontcolor = \"#F0F921FF\", fillcolor = \"#B12A90FF\"] \n  \"7\" [label = \"2\", fontcolor = \"#F0F921FF\", fillcolor = \"#B12A90FF\"] \n  \"8\" [label = \"2\", fontcolor = \"#F0F921FF\", fillcolor = \"#B12A90FF\"] \n  \"9\" [label = \"2\", fontcolor = \"#F0F921FF\", fillcolor = \"#B12A90FF\"] \n  \"10\" [label = \"4\", fontcolor = \"#6A00A8FF\", fillcolor = \"#FCA636FF\"] \n  \"11\" [label = \"2\", fontcolor = \"#F0F921FF\", fillcolor = \"#B12A90FF\"] \n  \"12\" [label = \"2\", fontcolor = \"#F0F921FF\", fillcolor = \"#B12A90FF\"] \n  \"13\" [label = \"2\", fontcolor = \"#F0F921FF\", fillcolor = \"#B12A90FF\"] \n  \"14\" [label = \"3\", fontcolor = \"#0D0887FF\", fillcolor = \"#E16462FF\"] \n  \"15\" [label = \"2\", fontcolor = \"#F0F921FF\", fillcolor = \"#B12A90FF\"] \n  \"16\" [label = \"1\", fontcolor = \"#FCA636FF\", fillcolor = \"#6A00A8FF\"] \n  \"17\" [label = \"1\", fontcolor = \"#FCA636FF\", fillcolor = \"#6A00A8FF\"] \n  \"18\" [label = \"3\", fontcolor = \"#0D0887FF\", fillcolor = \"#E16462FF\"] \n  \"19\" [label = \"2\", fontcolor = \"#F0F921FF\", fillcolor = \"#B12A90FF\"] \n  \"20\" [label = \"1\", fontcolor = \"#FCA636FF\", fillcolor = \"#6A00A8FF\"] \n  \"21\" [label = \"1\", fontcolor = \"#FCA636FF\", fillcolor = \"#6A00A8FF\"] \n\"1\"->\"2\" [label = \"NNN\"] \n\"2\"->\"3\" [label = \"NNN\"] \n\"1\"->\"4\" [label = \"NNT\"] \n\"4\"->\"5\" [label = \"NNN\"] \n\"1\"->\"6\" [label = \"NTT\"] \n\"6\"->\"7\" [label = \"NNN\"] \n\"1\"->\"8\" [label = \"TTT\"] \n\"8\"->\"9\" [label = \"NNN\"] \n\"2\"->\"10\" [label = \"NNT\"] \n\"4\"->\"11\" [label = \"NNT\"] \n\"6\"->\"12\" [label = \"NNT\"] \n\"8\"->\"13\" [label = \"NNT\"] \n\"2\"->\"14\" [label = \"NTT\"] \n\"4\"->\"15\" [label = \"NTT\"] \n\"6\"->\"16\" [label = \"NTT\"] \n\"8\"->\"17\" [label = \"NTT\"] \n\"2\"->\"18\" [label = \"TTT\"] \n\"4\"->\"19\" [label = \"TTT\"] \n\"6\"->\"20\" [label = \"TTT\"] \n\"8\"->\"21\" [label = \"TTT\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>A 3+3 trial with de-escalation enabled will de-escalate through the doses when toxicity is seen, as expected.</p>
</div>
</div>
<div id="crystallised-dose-paths" class="section level1">
<h1>Crystallised dose-paths</h1>
<p>Calculating dose-paths is useful for visually examining the conditions under which a dose-finding design would escalate or de-escalate or stop.
However, that is only part of the story.
When we marry dose-paths with assumed true event probabilities, we can calculate exact operating characteristics of a design.
We refer to this as <em>crystallising</em> dose paths because the likelihood of each path has been calculated precisely according to an assumed truth.</p>
<p>For instance, we can calculate dose-paths for the first four cohorts of three patients using the CRM with stopping design that we specified previously:</p>
<pre class="r"><code>skeleton &lt;- c(0.05, 0.1, 0.25, 0.4, 0.6)
target &lt;- 0.25

paths &lt;- get_dfcrm(skeleton = skeleton, target = target) %&gt;%
  stop_when_too_toxic(dose = 1, tox_threshold = 0.35, confidence = 0.9) %&gt;% 
  get_dose_paths(cohort_sizes = rep(3, 4))</code></pre>
<pre><code>## You have requested 341 model evaluations. Be patient.</code></pre>
<p>We can then crystallise the paths using toxicity probabilities that exactly match the beliefs in our skeleton:</p>
<pre class="r"><code>true_prob_tox &lt;- skeleton

x &lt;- paths %&gt;% calculate_probabilities(true_prob_tox = true_prob_tox)
x</code></pre>
<pre><code>## Number of nodes: 213 
## Number of terminal nodes: 160 
## 
## Number of doses: 5 
## 
## Probability of recommendation:
##   NoDose        1        2        3        4        5 
## 0.000127 0.019866 0.227135 0.451791 0.273014 0.028066 
## 
## Probability of continuance:
## [1] 1
## 
## Probability of administration:
##      1      2      3      4      5 
## 0.3172 0.1602 0.1867 0.2734 0.0626 
## 
## Expected sample size:
## [1] 11.99887
## 
## Expected total toxicities:
## [1] 2.705489</code></pre>
<p>We see that in this scenario, the probability of a path stopping and advocating no dose within the first four cohorts is very close to zero.
In contrast, when the toxicity probabilities are much greater than anticipated:</p>
<pre class="r"><code>true_prob_tox &lt;- c(0.45, 0.6, 0.68, 0.75, 0.81)

x &lt;- paths %&gt;% calculate_probabilities(true_prob_tox = true_prob_tox)
x</code></pre>
<pre><code>## Number of nodes: 213 
## Number of terminal nodes: 160 
## 
## Number of doses: 5 
## 
## Probability of recommendation:
##    NoDose         1         2         3         4         5 
## 0.3027462 0.6407708 0.0502073 0.0055527 0.0006931 0.0000299 
## 
## Probability of continuance:
## [1] 0.697
## 
## Probability of administration:
##        1        2        3        4        5 
## 0.895800 0.052921 0.008539 0.042028 0.000711 
## 
## Expected sample size:
## [1] 10.73269
## 
## Expected total toxicities:
## [1] 5.102913</code></pre>
<p>the probability of selecting no dose within these first four cohorts is over 30%.
The information labelled <code>Probability of continuance:</code> shows the aggregate probability of paths that are continuing to advocate experimentation at doses, i.e. those paths that do not advocate stopping.</p>
<p>We see above that the probability of continuance is 1 minus the probability of selecting no dose.
However, this need not necessarily be the case because paths can advocate stopping <em>and recommend a dose</em>.
They might do so once it is felt that a suitable dose has been identified.
To make this point, let us imagine that we add a rule to our above design that allows stopping once there are 9 patients allocated to the recommended dose.
We can think of this as stopping for consensus.
Respecifying our model and recalculating dose-paths, we have:</p>
<pre class="r"><code>paths &lt;- get_dfcrm(skeleton = skeleton, target = target) %&gt;%
  stop_when_too_toxic(dose = 1, tox_threshold = 0.35, confidence = 0.9) %&gt;% 
  stop_when_n_at_dose(dose = &#39;recommended&#39;, n = 9) %&gt;% 
  get_dose_paths(cohort_sizes = rep(3, 4))</code></pre>
<pre><code>## You have requested 341 model evaluations. Be patient.</code></pre>
<pre class="r"><code>x &lt;- paths %&gt;% calculate_probabilities(true_prob_tox = true_prob_tox)
x</code></pre>
<pre><code>## Number of nodes: 141 
## Number of terminal nodes: 106 
## 
## Number of doses: 5 
## 
## Probability of recommendation:
##    NoDose         1         2         3         4         5 
## 0.2103223 0.7393498 0.0440522 0.0055527 0.0006931 0.0000299 
## 
## Probability of continuance:
## [1] 0.137
## 
## Probability of administration:
##        1        2        3        4        5 
## 0.895800 0.052921 0.008539 0.042028 0.000711 
## 
## Expected sample size:
## [1] 9.064864
## 
## Expected total toxicities:
## [1] 4.352391</code></pre>
<p>We see that this has reduced our probability of stopping for excess toxicity and inflated our chances of recommending dose 1.
Notably, the probability of continuance is now roughly 14%, suggesting that most paths have advocated stopping by now, either for toxicity or concensus.</p>
<p>If we do not like that performance, we can make the consensus stopping rule more demanding by requesting 12 at the recommended dose to advocate stopping:</p>
<pre class="r"><code>paths &lt;- get_dfcrm(skeleton = skeleton, target = target) %&gt;%
  stop_when_too_toxic(dose = 1, tox_threshold = 0.35, confidence = 0.9) %&gt;% 
  stop_when_n_at_dose(dose = &#39;recommended&#39;, n = 12) %&gt;% 
  get_dose_paths(cohort_sizes = rep(3, 4))</code></pre>
<pre><code>## You have requested 341 model evaluations. Be patient.</code></pre>
<pre class="r"><code>x &lt;- paths %&gt;% calculate_probabilities(true_prob_tox = true_prob_tox)
x</code></pre>
<pre><code>## Number of nodes: 213 
## Number of terminal nodes: 160 
## 
## Number of doses: 5 
## 
## Probability of recommendation:
##    NoDose         1         2         3         4         5 
## 0.3027462 0.6407708 0.0502073 0.0055527 0.0006931 0.0000299 
## 
## Probability of continuance:
## [1] 0.24
## 
## Probability of administration:
##        1        2        3        4        5 
## 0.895800 0.052921 0.008539 0.042028 0.000711 
## 
## Expected sample size:
## [1] 10.73269
## 
## Expected total toxicities:
## [1] 5.102913</code></pre>
<p>As usual, deriving an acceptable design is an iterative process.
The tools in <code>escalation</code> make it easier to arrive at a design that performs how you want.</p>
<p>Combining dose-paths with true event probabilities allows probabilistic inference on dose-finding designs.
This is a novel extension to the use advocated by <span class="citation">Yap et al. (2017)</span> and <span class="citation">Brock et al. (2017)</span>.
The use of exact operating characteristics has been implemented for the 3+3 design in the <code>bcrm</code> package <span class="citation">(Sweeting and Wheeler 2019)</span>.
We generalise the method here.</p>
<div id="dose-paths-vs-simulation" class="section level2">
<h2>Dose-paths vs simulation</h2>
<p>We saw above that probabilistic inference was possible with dose-paths.
Researchers have typically used simulation to achieve this task.
<code>escalation</code> supports simulation as well through the <code>simulate_trials</code> function.
However, this does raise the question, when should you use each method, and what are their relative merits?</p>
<p>The answer to the first question comes down to the expected number of model fits required.
Fitting dose-finding models takes computer time.
In dose-paths, the model is fit once at each node.
We have seen examples above of how the number and size of cohorts affects the number of nodes in dose-paths.
In fact, <code>escalation</code> provides a function to calculate the number of nodes.</p>
<p>In a phase 1 dose-finding trial, each patient experiences exactly one of two outcomes: <code>T</code> or <code>N</code>.
Let us calculate how many nodes there are in a graph of dose-paths using five cohorts of three patients.
We run:</p>
<pre class="r"><code>num_dose_path_nodes(num_patient_outcomes = 2, cohort_sizes = rep(3, 5))</code></pre>
<pre><code>## [1]    1    4   16   64  256 1024</code></pre>
<p>The <code>num_patient_outcomes = 2</code> parameter reflects that patients may experience <code>T</code> or <code>N</code>.
The returned vector of integers is the number of nodes at each depth.
There is one starting node.
That node is connected to four children via outcomes <code>NNN</code>, <code>NNT</code>, <code>NTT</code>, and <code>TTT</code>.
The number of nodes at greater depths proceeds multiplicatively thereafter.
The total number of nodes is:</p>
<pre class="r"><code>num_dose_path_nodes(num_patient_outcomes = 2, cohort_sizes = rep(3, 5)) %&gt;% 
  sum</code></pre>
<pre><code>## [1] 1365</code></pre>
<p>Thus it requires exactly 1,365 model fits to calculate the exact operating characteristics in this <span class="math inline">\(n = 5 \times 3 = 15\)</span> patient scenario.
To compare this to simulations, consider that each simulated trial iteration will fit the model up to five times, once at the end of each cohort.
The total number of model fits in a simulation study is bounded by this number multiplied by the number of simulated iterations.
Generally simulation studies use thousands of replicates, so it is easy to see that exact inference via crystallised dose-paths will be much less computaionally burdensome, and therefore faster here.</p>
<p>In contrast, now consider a trial of eight cohorts of three.
The total number of model fits to enumerate the complete graph of dose-paths is</p>
<pre class="r"><code>num_dose_path_nodes(num_patient_outcomes = 2, cohort_sizes = rep(3, 8)) %&gt;% 
  sum</code></pre>
<pre><code>## [1] 87381</code></pre>
<p>Ten thousand simulated iterations of 8 cohorts each would only require up to 80,000 model fits.
Thus, a reasonably accurate simulation study would be expected to be faster here.</p>
<p>However, speed is not the only concern: there is also precision to consider.
Simulations have the disadvantage of suffering from Monte Carlo error, that is the uncertainty about the estimated statistics arising from the use of a finite number of simulated iterations.
In contrast, exact inference via dose-paths has the great advantage of being exact.
That is, there is no uncertainty in the calculated probabilities.
(Note: there is still uncertainty about which path will be taken because that is determined by random patient outcomes).
Thus, there are scenarios when dose-paths may still be preferable to simulations, even when they are expected to take longer.</p>
<p>It is likely that in practice, simulation is often used when dose-paths would be a better option.
If true, that would likely be linked to provision of software that performs the two methods.
<code>escalation</code> plugs that gap.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-Brock2017a">
<p>Brock, Kristian, Lucinda Billingham, Mhairi Copland, Shamyla Siddique, Mirjana Sirovica, and Christina Yap. 2017. “Implementing the EffTox Dose-Finding Design in the Matchpoint Trial.” <em>BMC Medical Research Methodology</em> 17 (1): 112. <a href="https://doi.org/10.1186/s12874-017-0381-x">https://doi.org/10.1186/s12874-017-0381-x</a>.</p>
</div>
<div id="ref-dfcrm">
<p>Cheung, Ken. 2013. <em>Dfcrm: Dose-Finding by the Continual Reassessment Method</em>. <a href="https://CRAN.R-project.org/package=dfcrm">https://CRAN.R-project.org/package=dfcrm</a>.</p>
</div>
<div id="ref-liu_bayesian_2015">
<p>Liu, Suyu, and Ying Yuan. 2015. “Bayesian Optimal Interval Designs for Phase I Clinical Trials.” <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em> 64 (3): 507–23. <a href="https://doi.org/10.1111/rssc.12089">https://doi.org/10.1111/rssc.12089</a>.</p>
</div>
<div id="ref-OQuigley1990">
<p>O’Quigley, J, M Pepe, and L Fisher. 1990. “Continual Reassessment Method: A Practical Design for Phase 1 Clinical Trials in Cancer.” <em>Biometrics</em> 46 (1): 33–48. <a href="https://doi.org/10.2307/2531628">https://doi.org/10.2307/2531628</a>.</p>
</div>
<div id="ref-bcrm">
<p>Sweeting, Michael, and Graham Wheeler. 2019. <em>Bcrm: Bayesian Continual Reassessment Method for Phase I Dose-Escalation Trials</em>. <a href="https://CRAN.R-project.org/package=bcrm">https://CRAN.R-project.org/package=bcrm</a>.</p>
</div>
<div id="ref-wheelerHowDesignDosefinding2019">
<p>Wheeler, Graham M., Adrian P. Mander, Alun Bedding, Kristian Brock, Victoria Cornelius, Andrew P. Grieve, Thomas Jaki, et al. 2019. “How to Design a Dose-Finding Study Using the Continual Reassessment Method.” <em>BMC Medical Research Methodology</em> 19 (1). <a href="https://doi.org/10.1186/s12874-018-0638-z">https://doi.org/10.1186/s12874-018-0638-z</a>.</p>
</div>
<div id="ref-Yap2017">
<p>Yap, Christina, Lucinda J. Billingham, Ying Kuen Cheung, Charlie Craddock, and John O’Quigley. 2017. “Dose Transition Pathways: The Missing Link Between Complex Dose-Finding Designs and Simple Decision-Making.” <em>Clinical Cancer Research</em> 23 (24): 7440–7. <a href="https://doi.org/10.1158/1078-0432.CCR-17-0582">https://doi.org/10.1158/1078-0432.CCR-17-0582</a>.</p>
</div>
<div id="ref-BOIN">
<p>Yuan, Ying, and Suyu Liu. 2018. <em>BOIN: Bayesian Optimal Interval (Boin) Design for Single-Agent and Drug- Combination Phase I Clinical Trials</em>. <a href="https://CRAN.R-project.org/package=BOIN">https://CRAN.R-project.org/package=BOIN</a>.</p>
</div>
</div>
</div>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="../../tags/escalation/">escalation</a>
  
  <a class="badge badge-light" href="../../tags/r/">R</a>
  
  <a class="badge badge-light" href="../../tags/dosefinding/">DoseFinding</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/dose-paths/&amp;text=Dose-paths%20in%20the%20escalation%20package" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/dose-paths/&amp;t=Dose-paths%20in%20the%20escalation%20package" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Dose-paths%20in%20the%20escalation%20package&amp;body=/post/dose-paths/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/dose-paths/&amp;title=Dose-paths%20in%20the%20escalation%20package" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Dose-paths%20in%20the%20escalation%20package%20/post/dose-paths/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/dose-paths/&amp;title=Dose-paths%20in%20the%20escalation%20package" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  
  
    
  
  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      <img class="portrait mr-3" src="https://s.gravatar.com/avatar/ba2fdaa5d7c978ce64a39a93043d05ca?s=200')" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="../../">Kristian Brock</a></h5>
      <h6 class="card-subtitle">Principal Biostatistician</h6>
      <p class="card-text">I am an academic early phase clincial trial statistician.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="../../#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/CatchTwentyToo" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.co.uk/citations?user=zoh03M4AAAAJ&amp;hl=en" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/brockk/" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="../../post/introducing-escalation/">Introducing escalation</a></li>
      
      <li><a href="../../project/escalation/">The escalation package</a></li>
      
      <li><a href="../../post/crm-simulations-checklist/">CRM Simulation Checklist</a></li>
      
      <li><a href="../../publication/crm-tutorial/">How to design a dose-finding study using the continual reassessment method</a></li>
      
      <li><a href="../../publication/viola-results/">Combination Lenalidomide and Azacitidine - A Novel Salvage Therapy in Patients Who Relapse After Allogeneic Stem-Cell Transplantation for Acute Myeloid Leukemia</a></li>
      
    </ul>
  </div>
  



  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.3/mermaid.min.js" integrity="" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="../../js/academic.min.600a2e440c16093e23e26e90951c4d4b.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    
      <a href="../../privacy/">Privacy Policy</a>
    
    
       &middot; 
      <a href="../../terms/">Terms</a>
    
  </p>
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
